namespace = monster_attack

monster_attack.1 = {
    type = country_event
    dlc = dlc_magic_gate
    placement = scope:monster_attack_state

    title = monster_attack.1.t
    desc = monster_attack.1.d
    flavor = monster_attack.1.f

    event_image = {
        video = "southamerica_war_civilians"
    }

    on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

    icon = "gfx/interface/icons/event_icons/event_skull.dds"

    duration = 3

    trigger = {
        is_player = yes
        has_global_variable = gate_mana_saturation_progress
        global_var:gate_mana_saturation_progress >= 30
        NOT = {
            has_global_variable = monster_attack_in_progress
        }
    }

    immediate = {
        set_global_variable = monster_attack_happened
        add_journal_entry = {
            type = je_monster_congress
        }
        set_global_variable = {
            name = monster_attack_in_progress
            months = 3
        }
        random_state = {
            save_scope_as = monster_attack_state
            owner = {
                save_scope_as = monster_attack_country
            }
        }
        scope:monster_attack_country = {
            random_military_formation = {
                save_scope_as = monster_attack_formation
            }
            random_scope_general = {
                save_scope_as = monster_attack_general
            }
        }
        # For five years after the first attack no more monster attacks will happen
        every_country = {
            set_variable = {
                name = monster_attack_grace_period
                years = 5
            }
        }
    }

    # Our State
    option = {
        name = monster_attack.1.a1
        default_option = yes
        hidden_effect = {
            trigger_event = {
                id = monster_attack.2
                months = 3
            }
        }
        scope:monster_attack_general = {
            set_character_busy_and_immortal = yes
        }
        trigger = {
            owner = scope:monster_attack_country
        }
    }
    option = {
        name = monster_attack.1.b1
        hidden_effect = {
            # Fuck around
            trigger_event = {
                id = monster_attack.3
                months = 3
            }
        }
        trigger = {
            owner = scope:monster_attack_country
        }
    }

    # Other countries state
    option = {
        name = monster_attack.1.a2
        change_relations = {
            country = scope:monster_attack_country
            value = 20
        }
        add_modifier = {
            name = monster_attack_cost_modifier
            months = 7
            multiplier = money_amount_multiplier_very_small
        }
        remove_global_variable = monster_attack_in_progress
        trigger = {
            NOT = {
                owner = scope:monster_attack_country
            }
        }
    }
    option = {
        name = monster_attack.1.b2
        change_relations = {
            country = scope:monster_attack_country
            value = 10
        }
        add_modifier = {
            name = monster_attack_cost_modifier
            months = 7
            multiplier = money_amount_multiplier_small
        }
        hidden_effect = {
            trigger_event = {
                id = researching_magic.1
                months = 3
            }
        }
        remove_global_variable = monster_attack_in_progress
        trigger = {
            has_journal_entry = je_researching_magic
            NOT = {
                owner = scope:monster_attack_country
            }
        }
    }
    option = {
        name = monster_attack.1.c2
        default_option = yes
        change_relations = {
            country = scope:monster_attack_country
            value = -30
        }
        remove_global_variable = monster_attack_in_progress
        change_infamy = 5
        trigger = {
            NOT = {
                owner = scope:monster_attack_country
            }
        }
    }
}

monster_attack.2 = {
    type = country_event
    dlc = dlc_magic_gate
    placement = scope:monster_attack_state

    event_image = {
        video = "southamerica_war_civilians"
    }

    icon = "gfx/interface/icons/event_icons/event_military.dds"

    title = monster_attack.2.t
    desc = monster_attack.2.d
    flavor = monster_attack.2.f

    option = {
        name = monster_attack.2.a
        default_option = yes
        scope:monster_attack_state = {
            state_region = {
                add_devastation = 10
            }
        }
        scope:monster_attack_general = {
            add_trait = monster_killer
            add_trait = wounded
            set_character_busy_and_immortal = no
        }
        scope:monster_attack_formation = {
            add_organization = -50
        }
        remove_global_variable = monster_attack_in_progress
    }

    option = {
        name = monster_attack.2.b
        scope:monster_attack_state = {
            state_region = {
                add_devastation = 10
            }
        }
        scope:monster_attack_general = {
            add_trait = monster_killer
            add_trait = wounded
            set_character_busy_and_immortal = no
        }
        scope:monster_attack_formation = {
            add_organization = -50
        }
        trigger_event = {
            id = researching_magic.1
            months = 3
        }
        remove_global_variable = monster_attack_in_progress
        trigger = {
            has_journal_entry = je_researching_magic
        }
    }
}

# Find out
monster_attack.3 = {
    type = country_event
    dlc = dlc_magic_gate
    placement = scope:monster_attack_state

    event_image = {
        video = "southamerica_war_civilians"
    }

    icon = "gfx/interface/icons/event_icons/event_skull.dds"

    title = monster_attack.3.t
    desc = monster_attack.3.d
    flavor = monster_attack.3.f

    option = {
        name = monster_attack.3.a
        scope:monster_attack_state = {
            state_region = {
                add_devastation = 80
            }
            kill_population_percent_in_state = {
                percent = 0.3
            }
            every_neighbouring_state = {
                limit = {
                    NOT = {
                        this = scope:monster_attack_state
                    }
                }
                state_region = {
                    add_devastation = 50
                }
                kill_population_percent_in_state = {
                    percent = 0.1
                }
            }
        }

        # Public outrage
        capital = {
            add_radicals_in_state = {
                value = medium_radicals
            }
        }

        # World Wide outrage
        change_infamy = 5
        remove_global_variable = monster_attack_in_progress
    }
}

monster_attack.4 = {
    type = country_event
    dlc = dlc_magic_gate
    placement = capital

    event_image = {
        video = "southamerica_aristocrats"
    }

    title = monster_attack.4.t
    desc = monster_attack.4.d
    flavor = monster_attack.4.f

    option = {
        name = monster_attack.4.a
    }
}

monster_attack.5 = {
    type = country_event
    dlc = dlc_magic_gate
    placement = scope:monster_attack_state

    title = monster_attack.5.t
    desc = monster_attack.5.d
    flavor = monster_attack.5.f

    event_image = {
        video = "southamerica_war_civilians"
    }

    on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

    icon = "gfx/interface/icons/event_icons/event_skull.dds"

    duration = 3

    trigger = {
        AND = {
            has_global_variable = monster_attack_happened
            NOT = {
                has_variable = monster_attack_grace_period
            }
        }
    }

    immediate = {
        set_global_variable = monster_attack_happened
        add_journal_entry = {
            type = je_monster_congress
        }
        set_global_variable = {
            name = monster_attack_in_progress
            months = 3
        }
        random_scope_state = {
            save_scope_as = monster_attack_state
        }
    }

    # Has Monster Hunters
    option = {
        name = monster_attack.5.a1
        default_option = yes
        scope:monster_attack_state = {
            add_devastation = 5
        }
        set_variable = {
            name = monster_attack_grace_period
            months = 6
        }
        trigger = {
            NOT = {
                has_law = law_type:law_no_organized_monster_hunting
            }
        }
    }
    option = {
        name = monster_attack.5.b1
        scope:monster_attack_state = {
            add_devastation = 5
        }
        set_variable = {
            name = monster_attack_grace_period
            months = 6
        }
        trigger_event = {
            id = researching_magic.1
            months = 3
        }
        trigger = {
            AND = {
                NOT = {
                    has_law = law_type:law_no_organized_monster_hunting
                }
                has_journal_entry = je_researching_magic
            }
        }
    }

    # Has no Monster Hunters
    option = {
        name = monster_attack.5.a2
        default_option = yes
        scope:monster_attack_state = {
            add_devastation = 10
        }
        set_variable = {
            name = monster_attack_grace_period
            months = 3
        }
        trigger = {
            has_law = law_type:law_no_organized_monster_hunting
        }
    }
}