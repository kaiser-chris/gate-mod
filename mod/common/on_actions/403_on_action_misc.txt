# Root = Building
on_building_built = {
    on_actions = {
        on_research_institute_built
    }
}

on_research_institute_built = {
    effect = {
        if = {
            limit = {
                is_building_type = building_magic_research_institute
            }
            owner = {
                trigger_event = researching_magic.3
            }
        }
    }
}

on_diplomatic_play_started = {
    on_actions = {
        on_diplomatic_play_started_custom_war_goal
    }
}

on_diplomatic_play_started_custom_war_goal = {
    effect = {
        if = {
            limit = {
                is_diplomatic_play_type = dp_demand_magic_knowledge
            }
            add_to_variable_list = {
                name = com_active_war_goals_primary
                target = bt:gate_war_goal_demand_magic
            }
        }
    }
}

# Root = Country
# scope:target = the country the wargoal was enforced against
# scope:diplomatic_play = the relevant diplomatic play
# scope:wargoal_impact = the impact of the wargoal enforced
on_wargoal_enforced = {
    on_actions = {
        on_wargoal_enforced_custom_war_goal
    }
}

on_wargoal_enforced_custom_war_goal = {
    effect = {
        if = {
            limit = {
                scope:diplomatic_play = {
                    is_target_in_variable_list = {
                        name = com_active_war_goals
                        target = bt:gate_war_goal_demand_magic
                    }
                }
            }
            learn_magic = yes
        }
    }
}


# Root = Diplomatic Play
on_diplo_play_back_down = {
    on_actions = {
        on_diplomatic_play_back_down_custom_war_goal
    }
}

on_diplomatic_play_back_down_custom_war_goal = {
    effect = {
        if = {
            limit = {
                is_target_in_variable_list = {
                    name = com_active_war_goals_primary
                    target = bt:gate_war_goal_demand_magic
                }
            }
            scope:notification_target = {
                learn_magic = yes
            }
        }
    }
}