add_mage_towers = {
	if = {
		limit = {
			is_magic_country = yes
		}
		save_temporary_scope_as = magic_country
		every_scope_state = {
			limit = {
				any_scope_pop = {
					is_pop_type = mages
				}
			}
			if = {
				limit = {
					pop_type_percent_state = {
						target = pop_type:mages
						value < 0.1
					}
					NOT = {
						state_has_building_type_levels = {
							target = bt:building_mage_tower
							value = 1
						}
					}
				}
				create_mage_tower = {
					country = root
					level = 1
				}
			}
			else_if = {
				limit = {
					pop_type_percent_state = {
						target = pop_type:mages
						value >= 0.1
					}
					pop_type_percent_state = {
						target = pop_type:mages
						value < 0.2
					}
					NOT = {
						state_has_building_type_levels = {
							target = bt:building_mage_tower
							value = 2
						}
					}
				}
				create_mage_tower = {
					country = root
					level = 2
				}
			}
			else_if = {
				limit = {
					pop_type_percent_state = {
						target = pop_type:mages
						value >= 0.2
					}
					pop_type_percent_state = {
						target = pop_type:mages
						value < 0.3
					}
					NOT = {
						state_has_building_type_levels = {
							target = bt:building_mage_tower
							value = 3
						}
					}
				}
				create_mage_tower = {
					country = root
					level = 3
				}
			}
			else_if = {
				limit = {
					pop_type_percent_state = {
						target = pop_type:mages
						value >= 0.3
					}
					pop_type_percent_state = {
						target = pop_type:mages
						value < 0.4
					}
					NOT = {
						state_has_building_type_levels = {
							target = bt:building_mage_tower
							value = 4
						}
					}
				}
				create_mage_tower = {
					country = root
					level = 4
				}
			}
			else_if = {
				limit = {
					pop_type_percent_state = {
						target = pop_type:mages
						value >= 0.4
					}
					NOT = {
						state_has_building_type_levels = {
							target = bt:building_mage_tower
							value = 5
						}
					}
				}
				create_mage_tower = {
					country = root
					level = 5
				}
			}
		}
	}
}

# Root = state
create_mage_tower = {
	if = {
		limit = {
			has_building = building_mage_tower
		}
		remove_building = building_mage_tower
	}
	create_building = {
		building = building_mage_tower
		add_ownership = {
			country = {
				country = $country$
				levels = $level$
			}
		}
		reserves = 1
	}
}