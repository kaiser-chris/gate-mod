calculate_monthly_mana_saturation = {
	set_global_variable = {
		name = gate_mana_saturation_progress_ritual_var
		value = 0
	}
	
	# Every month we calculate new
	set_global_variable = {
		name = gate_mana_saturation_progress_mages_var
		value = 0
	}
	set_global_variable = {
		name = gate_mana_saturation_progress_buildings_var
		value = 0
	}

	every_country = {
		calculate_monthly_mages_mana_satuaration = yes
		calculate_monthly_building_mana_satuaration = yes
	}

	# Every building level and mage has only a small
	# influence on global mana saturation
	change_global_variable = {
		name = gate_mana_saturation_progress_buildings_var
		divide = 100
	}
	change_global_variable = {
		name = gate_mana_saturation_progress_mages_var
		divide = 100
	}
}

calculate_monthly_building_mana_satuaration = {
	# Inherently magic buildings
	every_scope_building = {
		limit = {
			OR = {
				is_building_type = building_murk_ways
				is_building_type = building_mana_extractor
			}
			occupancy >= 0.5
		}
		change_global_variable = {
			name = gate_mana_saturation_progress_buildings_var
			add = level
		}
	}

	# Magic production methods
	every_scope_building = {
		limit = {
			OR = {
				has_active_production_method = pm_crystal_explosives_building_gold_mine
				has_active_production_method = pm_crystal_explosives_building_lead_mine
				has_active_production_method = pm_crystal_explosives_building_sulfur_mine
				has_active_production_method = pm_crystal_explosives_building_iron_mine
				has_active_production_method = pm_crystal_explosives_building_coal_mine
			}
			occupancy >= 0.5
		}
		change_global_variable = {
			name = gate_mana_saturation_progress_buildings_var
			add = level
		}
	}
}

calculate_monthly_mages_mana_satuaration = {
	# There seems to be no way to get the population of a specific pop
	# The only way to get population numbers is by state
	# So we for now we just count the consolidated pops
	every_scope_pop = {
		limit = {
			is_pop_type = mages
		}
		change_global_variable = {
			name = gate_mana_saturation_progress_mages_var
			add = 1
		}
	}
}